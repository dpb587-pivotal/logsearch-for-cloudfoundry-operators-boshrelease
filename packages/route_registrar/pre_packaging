#!/usr/bin/env bash
set -e

PACKAGE_NAME="github.com/cloudfoundry-incubator/route-registrar"
COMPILE_DIR=compile/src/${PACKAGE_NAME}

mkdir -p $(dirname $COMPILE_DIR)

cp -a $(basename $PACKAGE_NAME)/ $COMPILE_DIR

export PATH=$GOROOT/bin:$PATH
export GOPATH="$(pwd)/compile"

pushd $COMPILE_DIR

export GOARCH=amd64
export GOOS=linux
go build
popd

tree -L 2 $COMPILE_DIR
mv $COMPILE_DIR/route-registrar /tmp/
rm -rf route-registrar/* route-registrar/.git*
rm -rf $COMPILE_DIR
mv /tmp/route-registrar route-registrar/

